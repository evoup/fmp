<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>new campaign</title>
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/base.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/menu.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/dashboard.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/fbaccount.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/table.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/default/sidebar.css">
  <script type="text/javascript" src="../../assets/js/libs/jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="../../assets/js/libs/jquery.tmpl.js"></script>
  <script type="text/javascript" src="../../assets/js/base.js"></script>
</head>
<body>
    <div class="wrapper">
        <!--fmp_header-->
        <div class="header">
            <a href="/" title="visit fmp"><h1 class="mainlogo"><u style="display:none;">FMP</u></h1></a>
            <span class="beta">beta</span>
            <div class="userarea"><a href="/profiles/" id="user_profile_a"></a> | <a class="btn btn-sm btn-info" href="../" id="logout_btn" onclick="javascript:return false;">logout</a></div>
            <span class="description">a facebook  partner</span>
        </div>
        <script id="headerTemplate" type="text/x-jquery-tmpl">${UserName}</script>
        <!--/fmp_header-->
        <!--fmp_navibar-->
        <div class="navibar">
            <div class="navi">
                <ul>
                    <li><a href="../../../camps/">YOUR CAMPAIGNS</a></li>
                    <li><a href="../../../campaign/new/">NEW CAMPAIGN</a></li>
                    <li><a href="../../../report/">REPORT</a></li>
                    <li><a href="../../../settings/">SETTINGS</a></li>
                </ul>
                <div id="camp_select_div">
                    select camp:
                    <select>
                        <option>please select</option>
                        <option>xxxxx</option>
                    </select>
                </div>
            </div>
        </div>
        <!--/fmp_navibar-->
        <!--main-->
        <div class="main-content">
            <div class="row" id="main-area" style="text-align:center">
                <div class="col-sm-2" id="sidebar-area" style="text-align:left">
                    <!--sidebar-->
                    <!--/sidebar-->
                </div>
                <div class="col-sm-9" id="ad_edit_area" style="text-align:left">
                    <!--step1-->
                    <!--/step1-->
                </div>
            </div>
        </div>
        <!--/main-->
        <!--fmp_footer-->
        <div class="footer">
            <h2 class="logo">madhouse</h2>
            <h3 class="credits">Developed by Madhouse Inc</h3>
        </div>
        <!--/fmp_footer-->
    </div>
    <script>
      $(document).ready(function(){
          loading()
          $.ajax({
            url:baseConf.api_prefix+"/get/login/@self",
            method:"GET",
            success: function(data){
                    if (data.status=="false") { //没有登录退出
                        location.href="../"
                    }
                    var user = [
                    { UserName: data.username }
                    ]
                    $("#headerTemplate").tmpl(user).appendTo('.header #user_profile_a');
                }
            })
          bind_logout_btn()
    })
    //根据url参数判断是第几步，下载模板和ajax数据动态构造编辑页面
    //新的方法一次性下载全部模板<!--{{{-->
    //gced:global campaign edit data
    var gced={adaccounts:"",tpl_sidebar:"",tpl_step1:"",tpl_step2:"",tpl_step3:"",tpl_step4:""};
$.when(
  // Get the all available ad accounts
  $.get(baseConf.api_prefix+"/get/campaign/@step1", function(data) {
      gced.adaccounts=data
      console.log(data)
  }),
  $.get(baseConf.domain+"/templates/camp.sidebar.htm", function(data) {
     gced.tpl_sidebar=data
  }),
  $.get(baseConf.domain+"/templates/camp_step1.htm", function(data) {
     gced.tpl_step1=data
  }),
  $.get(baseConf.domain+"/templates/camp_step2.htm", function(data) {
     gced.tpl_step2=data
  }),
  $.get(baseConf.domain+"/templates/camp_step3.htm", function(data) {
     gced.tpl_step3=data
  }),
  $.get(baseConf.domain+"/templates/camp_step4.htm", function(data) {
     gced.tpl_step4=data
  })
).then(function() {
    $("#main-loading").remove()
    $.tmpl(gced.tpl_sidebar,null).appendTo('#sidebar-area');
    $.tmpl(gced.tpl_step1,gced.adaccounts).appendTo('#ad_edit_area');
});
<!--}}}-->

      function loading(){
        $('#main-area').append("<div id=\"main-loading\" style=\"margin-left:auto;margin-right:auto;padding-top:200px;color:#bbb;font-size:30px\"><i class=\"fa fa-cog fa-spin fa-3x fa-fw margin-bottom\"></i>loading...</div>")
    }
    function bind_logout_btn(){
       $("#logout_btn").bind("click",function(){
          $.ajax({
             url: baseConf.api_prefix+"/delete/login/@self",
             type: "GET",
             success: function(data){
                if (data.status=="true") {
                   location.href="http://"+document.domain;
               }
           }
       })
      })
   }
  function goStep2(){
      $("#ad_edit_area").html("");
    $.tmpl(gced.tpl_step2,null).appendTo('#ad_edit_area');
  }
  function goStep3(){
      $("#ad_edit_area").html("");
    $.tmpl(gced.tpl_step3,null).appendTo('#ad_edit_area');
  }
  function goStep4(){
      $("#ad_edit_area").html("");
    $.tmpl(gced.tpl_step4,null).appendTo('#ad_edit_area');
  }
</script>
</body>
</html>
